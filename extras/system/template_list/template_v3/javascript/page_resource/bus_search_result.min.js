$(document).ready(function(){function load_busses(){pre_load_audio();var _active_booking_source=JSON.parse(document.getElementById('pri_active_source').value);$.each(_active_booking_source,function(k,booking_source_name){core_bus_loader(booking_source_name)})}function core_bus_loader(booking_source_id){$('.loader-image').show();var params={booking_source:booking_source_id,search_id:document.getElementById('pri_search_id').value,op:'load'};$.ajax({type:'POST',url:app_base_url+'index.php/ajax/bus_list',async:true,cache:false,data:$.param(params),dataType:'json',success:function(result){$('.loader-image').hide();hide_result_pre_loader();if(result.hasOwnProperty('status')==true&&result.status==true){$('#bus_search_result').html(result.data);post_load_audio();update_filter();update_total_count_summary()}else{update_total_count_summary();check_empty_search_result()}}})}function check_empty_search_result(){if($('.r-r-i:first').index()==-1){$('#empty-search-result').show();$('#page-parent').hide()}}function update_total_count_summary(){$('#bus_search_result').show();var _visible_records=parseInt($('.r-r-i:visible').length);var _total_records=$('.r-r-i').length;if(isNaN(_visible_records)==true||_visible_records==0){_visible_records=0;$('#bus_search_result').hide();$('#empty_bus_search_result').show()}else{$('#bus_search_result').show();$('#empty_bus_search_result').hide()}if(_visible_records>1){_visible_records=_visible_records+' busses '}else{_visible_records=_visible_records+' bus '}$('#total_records').text(_visible_records+' found');$('.visible-row-record-count').text(_visible_records);$('.total-row-record-count').text(_total_records)}function update_filter(){var travelList={};var busTypeList=[];var departureCategoryList={};var arrivalCategoryList={};var minPrice=99999999;var maxPrice=0;var price=0;var dep_time=0;var arr_time=0;var temp_travel=''var temp_type=[];var busTypeCount={};$('.r-r-i').each(function(key,value){price=parseFloat($('.bus-price:first',this).text());depCat=parseInt($('.departure_datetime:first',this).data('departure-category'));arrCat=parseInt($('.arrival_datetime:first',this).data('arrival-category'));temp_travel=$('.travel-name:first',this).text();if(departureCategoryList.hasOwnProperty(depCat)==false){departureCategoryList[depCat]=depCat}if(arrivalCategoryList.hasOwnProperty(arrCat)==false){arrivalCategoryList[arrCat]=arrCat}if(travelList.hasOwnProperty(temp_travel)==false){travelList[temp_travel]=temp_travel}if(price<minPrice){minPrice=price}if(price>maxPrice){maxPrice=price}temp_type=$('.bus-type',this).map(function(){var temp_text=$(this).text();if((temp_text in busTypeCount)==false){busTypeCount[temp_text]=0}else{busTypeCount[temp_text]++}if(busTypeList.indexOf(temp_text)==-1){return temp_text}}).get();if(temp_type.length>0){busTypeList=busTypeList.concat(temp_type)}});$('#core_minimum_range_value','#core_min_max_slider_values').val(minPrice);$('#core_maximum_range_value','#core_min_max_slider_values').val(maxPrice);travelList=getSortedObject(travelList);busTypeList=getSortedObject(busTypeList);enable_price_range_slider(minPrice,maxPrice);enable_travel_refine(travelList);enable_bus_type_refine(busTypeList,busTypeCount);loadTimeRangeSelector(departureCategoryList,arrivalCategoryList)}function loadTimeRangeSelector(depCatList,arrCatList){if($.isPlainObject(depCatList)){var depCatListArray=getArray(depCatList);var stopCat=0;$('#departureTimeWrapper .time-category').each(function(key,value){depCat=parseInt($(this).val());if(depCatListArray.indexOf(depCat)==-1){$(this).attr('disabled','disabled');$(this).closest('.time-wrapper').addClass('disabled')}else{$(this).closest('.time-wrapper').addClass('enabled')}})}if($.isPlainObject(arrCatList)){var arrCatListArray=getArray(arrCatList);var arrCat=0;$('#arrivalTimeWrapper .time-category').each(function(key,value){arrCat=parseInt($(this).val());if(arrCatListArray.indexOf(arrCat)==-1){$(this).attr('disabled','disabled');$(this).closest('.time-wrapper').addClass('disabled')}else{$(this).closest('.time-wrapper').addClass('enabled')}})}}function getArray(objectWrap){var objectWrapValueArr=[];$.each(objectWrap,function(key,value){objectWrapValueArr.push(value)});return objectWrapValueArr}function getSortedObject(obj){var objValArray=getArray(obj);var sortObj={};objValArray.sort();$.each(objValArray,function(obj_key,obj_val){$.each(obj,function(i_k,i_v){if(i_v==obj_val){sortObj[i_k]=i_v}})});return sortObj}var sliderCurrency=document.getElementById('pri_slider_currency').value;var min_amt=0;var max_amt=0;function enable_price_range_slider(minPrice,maxPrice){min_amt=minPrice;max_amt=maxPrice;$("#slider-range-1").slider({range:true,min:minPrice,max:maxPrice,animate:"slow",values:[minPrice,maxPrice],slide:function(event,ui){set_slider_label(ui.values[0],ui.values[1])},change:function(event,ui){if(parseFloat(ui.values[0])==min_amt){if(parseFloat(ui.values[1])>max_amt){visibility=':hidden'}else{visibility=':visible'}}else{if(parseFloat(ui.values[0])<min_amt){visibility=':hidden'}else{visibility=':visible'}}filter_row_origin_marker(visibility)}});set_slider_label(minPrice,maxPrice)}function set_slider_label(val1,val2){$("#amount").text(sliderCurrency+val1+" - "+sliderCurrency+val2)}function enable_travel_refine(core_list){var list='<ul class="locationul">';if($.isEmptyObject(core_list)==false){$.each(core_list,function(k,v){list+='<li><div class="squaredThree">';list+='<input type="checkbox" id="airline-filter-'+k+'" class="airlinecheckbox travel-box" value="'+v+'"><label for="airline-filter-'+k+'"></label>';list+='</div>';list+='<label class="lbllbl" for="airline-filter-'+k+'"> '+v+'</label></li>'})}list+='</ul>';$('.travel-refine:first').append(list)}function enable_bus_type_refine(core_list,core_count_list){var list='<ul class="locationul">';if($.isEmptyObject(core_list)==false){$.each(core_list,function(k,v){list+='<li><div class="squaredThree">';list+='<input type="checkbox" id="airline-filter-'+k+'" class="airlinecheckbox bus-type-box" value="'+v+'"><label for="airline-filter-'+k+'"></label>';list+='</div>';list+='<label class="lbllbl" for="airline-filter-'+k+'"> '+v+'('+(parseInt(core_count_list[v])+1)+') </label></li>'})}list+='</ul>';$('.bustype-refine:first').append(list)}function timeConverter(UNIX_timestamp){var a=new Date(parseFloat(UNIX_timestamp));var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];var month=months[a.getMonth()];var year=a.getFullYear();var date=a.getDate();var hour=a.getHours();var min=a.getMinutes();var time=date+' '+month+' '+hour+':'+min;return time}$(document).on('change','.bus-type-box, .travel-box',function(){filter_row_origin_marker()});$(document).on('change','#departureTimeWrapper .time-wrapper.enabled .time-category, #arrivalTimeWrapper .time-wrapper.enabled .time-category',function(){filter_row_origin_marker()});function filter_row_origin_marker(){loader();visibility='';var bus_type_refine=$('.bus-type-box:checked:not(:disabled)','.bustype-refine').map(function(){return this.value}).get()var travel_refine=$('.travel-box:checked:not(:disabled)','.travel-refine').map(function(){return this.value}).get();var deptimeList=$('.time-category:checked:not(:disabled)','#departureTimeWrapper').map(function(){return parseInt(this.value)}).get();var arrtimeList=$('.time-category:checked:not(:disabled)','#arrivalTimeWrapper').map(function(){return parseInt(this.value)}).get();var min_price=parseFloat($("#slider-range-1").slider("values")[0]);var max_price=parseFloat($("#slider-range-1").slider("values")[1]);$('.r-r-i'+visibility).each(function(key,value){if((travel_refine.length==0||$.inArray($('.travel-name',this).text(),travel_refine)!=-1)&&(bus_type_refine.length==0||has_bus_type_attribute(bus_type_refine,this))&&((deptimeList.length==0)||($.inArray(parseInt($('.departure_datetime:first',this).data('departure-category')),deptimeList)!=-1))&&((arrtimeList.length==0)||($.inArray(parseInt($('.arrival_datetime:first',this).data('arrival-category')),arrtimeList)!=-1))&&(parseFloat($('.bus-price:first',this).text())>=min_price&&parseFloat($('.bus-price:first',this).text())<=max_price)){$(this).show()}else{$(this).hide()}});update_total_count_summary()}function has_bus_type_attribute(bus_type_refine,record_origin){var status=false;if(bus_type_refine.length==1){$('.bus-type',record_origin).each(function(k,v){if($.inArray($(this).text(),bus_type_refine)!=-1){status=true}})}else if(bus_type_refine.length>1){status=true;var _bus_type=$('.bus-type',record_origin).map(function(){return $(this).text()}).get();$.each(bus_type_refine,function(k,v){if($.inArray(v,_bus_type)==-1){status=false}})}return status}$(document).on('click',".more-bus-content-btn",function(){$(".more-bus-content-container",$(this).closest('.r-r-i')).toggle()});$(".price-l-2-h").click(function(){loader();$(this).addClass('hide');$('.price-h-2-l').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.bus-price:first',item:'.r-r-i',order:'asc',is_num:true})});$(".price-h-2-l").click(function(){$(this).addClass('hide');$('.price-l-2-h').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.bus-price:first',item:'.r-r-i',order:'desc',is_num:true})});$(".travel-l-2-h").click(function(){$(this).addClass('hide');$('.travel-h-2-l').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.travel-name:first',item:'.r-r-i',order:'asc',is_num:false})});$(".travel-h-2-l").click(function(){$(this).addClass('hide');$('.travel-l-2-h').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.travel-name:first',item:'.r-r-i',order:'desc',is_num:false})});$(".departure-l-2-h").click(function(){$(this).addClass('hide');$('.departure-h-2-l').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.departure-time:first',item:'.r-r-i',order:'asc',is_num:true})});$(".departure-h-2-l").click(function(){$(this).addClass('hide');$('.departure-l-2-h').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.departure-time:first',item:'.r-r-i',order:'desc',is_num:true})});$(".arrival-l-2-h").click(function(){$(this).addClass('hide');$('.arrival-h-2-l').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.arrival-time:first',item:'.r-r-i',order:'asc',is_num:true})});$(".arrival-h-2-l").click(function(){$(this).addClass('hide');$('.arrival-l-2-h').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.arrival-time:first',item:'.r-r-i',order:'desc',is_num:true})});$(".seat-l-2-h").click(function(){$(this).addClass('hide');$('.seat-h-2-l').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.available-seats:first',item:'.r-r-i',order:'asc',is_num:true})});$(".seat-h-2-l").click(function(){$(this).addClass('hide');$('.seat-l-2-h').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.available-seats:first',item:'.r-r-i',order:'desc',is_num:true})});$(".bus-type-l-2-h").click(function(){$(this).addClass('hide');$('.bus-type-h-2-l').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.bus-type-count:first',item:'.r-r-i',order:'asc',is_num:true})});$(".bus-type-h-2-l").click(function(){$(this).addClass('hide');$('.bus-type-l-2-h').removeClass('hide');$("#bus_search_result .r-w-g").jSort({sort_by:'.bus-type-count:first',item:'.r-r-i',order:'desc',is_num:true})});$('.loader').on('click',function(e){e.preventDefault();loader()});$(document).on('click','.reset-page-loader',function(e){e.preventDefault();loader();location.reload()});$(document).on('click','#reset_filters',function(){loader();var minPrice=$('#core_minimum_range_value','#core_min_max_slider_values').val();var maxPrice=$('#core_maximum_range_value','#core_min_max_slider_values').val();$("#slider-range-1").slider("option","values",[minPrice,maxPrice]);$('input.bus-type-box, input.time-category, input.travel-box').prop('checked',false);$('.enabled','#departureTimeWrapper').removeClass('active');$('.enabled','#arrivalTimeWrapper').removeClass('active');set_slider_label(min_amt,max_amt);filter_row_origin_marker()});function loader(selector){selector=selector||'#bus_search_result';$(selector).animate({'opacity':'.1'});setTimeout(function(){$(selector).animate({'opacity':'1'},'slow')},1000)}load_busses();show_result_pre_loader();$(document).on('click','.inner-summary-btn',function(e){e.preventDefault();var _inner_summary_toggle=$('.inner-summary-toggle',$(this).closest('.r-r-i'));_inner_summary_toggle.toggle();if(_inner_summary_toggle.is(':visible')){get_inner_bus_details($(this).closest('form').serializeArray(),_inner_summary_toggle)}else{$('.room-summ',_inner_summary_toggle).html('').hide();$('.loader-image',_inner_summary_toggle).show()}});function get_inner_bus_details(params,result_row_index){$.ajax({type:'POST',url:app_base_url+'index.php/ajax/get_bus_details',async:true,cache:false,data:params,success:function(result){if(result.status){$('.room-summ',result_row_index).html(result.data).show();$('.loader-image',result_row_index).hide()}}})}$(document).on('click','.bus-info-btn',function(e){e.preventDefault();clean_up_info_modal();var _bus_info_data=get_inner_bus_information($('.book-form',$(this).closest('.r-r-i')).serializeArray())});function clean_up_info_modal(){$('#bus-info-modal-content ').empty();$('#bus-info-modal .loader-image').show();$('#bus-info-modal').modal()}function get_inner_bus_information(params){$.ajax({type:'POST',url:app_base_url+'index.php/ajax/get_bus_information',async:true,cache:true,data:params,success:function(result){$('#bus-info-modal .loader-image').hide();if(result.status){$('#bus-info-modal-content').html(result.data)}else{$('#bus-info-modal-content').html('NA')}}})}$(document).on('click','.sorta',function(e){e.preventDefault();$(this).closest('.sortul').find('.active').removeClass('active');$(this).siblings().addClass('active')});$('.toglefil').click(function(){$(this).toggleClass('active')});$(document).on('click','.bus-boarding-info-btn',function(e){e.preventDefault();clean_up_boarding_modal();var _target_view=$(this).data('target');var _bus_info_data=get_board_bus_information($('.book-form',$(this).closest('.r-r-i')).serializeArray(),_target_view)});function clean_up_boarding_modal(){$('#bus-boarding-modal-content ').empty();$('#bus-boarding-modal .loader-image').show();$('#bus-boarding-modal').modal()}function get_board_bus_information(params,_target_view){$.ajax({type:'POST',url:app_base_url+'index.php/ajax/get_bus_details/true',async:true,cache:true,data:params,success:function(result){if(result.status){$('#bus-boarding-modal-content').html(result.data);$('#bus-boarding-modal-content').children().hide();$(_target_view).show()}else{$('#bus-boarding-modal-content').html('NA')}$('#bus-boarding-modal .loader-image').hide()}})}$('.filter_tab').click(function(){$('.resultalls').stop(true,true).toggleClass('open');$('.coleft').stop(true,true).slideToggle(500)});var widowwidth=$(window).width();if(widowwidth<991){$('.resultalls.open #bus_search_result').on('click',function(){$('.resultalls').removeClass('open');$('.coleft').slideUp(500)})}});
